#!/usr/bin/perluse CGI qw(:standard);# Ray Eads (coylh@eskimo.com)   4-14-1997$NUMBER_URL = "http://www.pni.org/esp/dice/.pictures/";$NUMBER_EXTENSION = ".gif";$NUMBER_WIDTH = 30;$NUMBER_HEIGHT = 30;$WEBDIR = "/home/content/48/7686848/html/_PNI/";$DATA_EXTENSION = ".dat";$SHOW_HITS = "no";	# yes/no$SHOW_GRAPHICS = "no";	# yes/no$DEBUG = "on";		# on/off#################################################################### Caution to those who change code below this line.               ## I am not a programmer, and your assumptions about               ## what I have done will hurt you.                                 ####################################################################print "Content-type: text/html\n\n";$data_file = $WEBDIR . "esp/dice/dice" . $DATA_EXTENSION;if ( $DEBUG eq "on" ){  print "DEBUG: Data file is $data_file.\n";}unless ( -r $data_file && -w $data_file ){  if ( $DEBUG eq "on" )  {    print "DEBUG: Can't read and/or write to $data_file.\n";  }  exit -1;}$LOCK = $data_file . ".lock";unless ( -e $data_file){  if ( $DEBUG eq "on" )  {    print "DEBUG: $data_file not found.  Starting a new data file.\n";  }  $wait_time = 1;  while ( -e $LOCK )  {    sleep 1;    if ( $wait_time > 3 )    {      if ( $DEBUG eq "on" )      {        print "DEBUG: Waited too long for write access to $data_file.\n";      }      exit -1;    }    $wait_time++;  }  open (FLOCK, ">$LOCK");  close FLOCK;  open (FDATA, ">$data_file") || die "Error: Can't open $data_file.\n";  print FDATA "0";  close FDATA;  unlink $LOCK}  $wait_time = 1;  while ( -e $LOCK )  {    sleep 1;    if ( $wait_time > 3 )    {      if ( $DEBUG eq "on" )      {        print "DEBUG: Waited too long for write access to $data_file.\n";      }      exit -1;    }    $wait_time++;  }open (FLOCK, ">$LOCK");close FLOCK;open (FDATA, "+<$data_file") || die "Error: Can't open $data_file.\n";$hits = <FDATA>;$hits++;seek FDATA, 0, 0;print FDATA "$hits";close(FDATA) || die "Error: Can't close $data_file.\n";unlink $LOCK;if ( $DEBUG eq "on" ){  print "DEBUG: $hits\n";}if ( $SHOW_HITS eq "yes" ){  if ( $SHOW_GRAPHICS eq "yes" )  {    @numbers = split ('', $hits);    if ( $DEBUG eq "on" )    {      print "DEBUG: " . join(' ', @numbers) . "\n";    }    for ($i = 0; $i < @numbers; $i++)    {      print "<IMG SRC=\"$NUMBER_URL" . $numbers[$i] . "$NUMBER_EXTENSION" . "\" BORDER=0 ALT=\"$numbers[$i]\" WIDTH=$NUMBER_WIDTH HEIGHT=$NUMBER_HEIGHT>\n";    }  }  else  {    print "$hits";  }}exit 0;